---
layout: post
title: "AWS SQS (Boto3) – Sending Messages"
categories: [AWS]
tags: [AWS]
---

Our team project uses Amazon SQS to move drone telemetry into the cloud in near real time.

<p align="center"><img src="/assets/img/post_img/capstone.png"></p>

Before wrapping up the full architecture, I wanted to document the gotchas I hit while wiring up Boto3.

<br>

### SQS Docs Sample Code

The official docs show:

```python
import boto3

sqs = boto3.client("sqs")

queue_url = "SQS_QUEUE_URL"

response = sqs.send_message(
    QueueUrl=queue_url,
    DelaySeconds=10,
    MessageAttributes={
        "Title": {"DataType": "String", "StringValue": "The Whistler"},
        "Author": {"DataType": "String", "StringValue": "John Grisham"},
        "WeeksOn": {"DataType": "Number", "StringValue": "6"},
    },
    MessageBody="Information about the NYT fiction bestseller for 12/11/2016.",
)

print(response["MessageId"])
```

I was puzzled—no credentials or region specified—yet the code assumes they’re already configured.

Simplifying the example:

```python
import boto3

sqs = boto3.client("sqs")

queue_url = "SQS_QUEUE_URL"

response = sqs.send_message(QueueUrl=queue_url, MessageBody="sqs_test")
print(response["MessageId"])
```

Running it produced two errors: missing region and missing credentials.

<br>

### Specify the Region

```python
sqs = boto3.client("sqs", region_name="ap-northeast-2")
```

That takes care of the first error.

<br>

### Provide Credentials

For SDK usage on Linux, create `~/.aws/credentials` (and the `.aws` folder if needed). Populate it with your IAM keys:

```ini
[default]
aws_access_key_id = YOUR_ACCESS_KEY
aws_secret_access_key = YOUR_SECRET_KEY
```

You can define multiple profiles:

```ini
[Profile1]
aws_access_key_id = YOUR_ACCESS_KEY1
aws_secret_access_key = YOUR_SECRET_KEY1
```

<br>

### Select the Profile in Code

```python
import boto3
import os

os.environ["AWS_PROFILE"] = "Profile1"

sqs = boto3.client("sqs", region_name="ap-northeast-2")
queue_url = "https://sqs.ap-northeast-2.amazonaws.com/996145069080/edge_data"

def send_message(body: str):
    return sqs.send_message(QueueUrl=queue_url, MessageBody=body)

send_message("send message : hello world")
```

Setting `AWS_PROFILE` instructs Boto3 to use the matching credentials from the `credentials` file. After that, messages flowed into SQS without issue. (If you set a default profile, you can even omit `region_name` and other parameters.)
